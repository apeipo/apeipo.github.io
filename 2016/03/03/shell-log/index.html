<!DOCTYPE html><html><head><meta charset="utf-8"><title>Shell从一段日志中取出两个字段的值 | linxianlong的博客</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Shell,"><meta name="description" content="WARNING: 01-12 19:36:50:  ral-worker * 30449 [conf/manager/helper/pool.cpp:241][logid=2210608107 worker_id=140610281404160 optime=1452598610.631276 msg=service+not+found+in+share+memory service=Redis_"><meta name="keywords" content="Shell"><meta property="og:type" content="article"><meta property="og:title" content="Shell从一段日志中取出两个字段的值"><meta property="og:url" content="http://longlog.me/2016/03/03/shell-log/index.html"><meta property="og:site_name" content="linxianlong的博客"><meta property="og:description" content="WARNING: 01-12 19:36:50:  ral-worker * 30449 [conf/manager/helper/pool.cpp:241][logid=2210608107 worker_id=140610281404160 optime=1452598610.631276 msg=service+not+found+in+share+memory service=Redis_"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2019-08-29T07:09:16.080Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Shell从一段日志中取出两个字段的值"><meta name="twitter:description" content="WARNING: 01-12 19:36:50:  ral-worker * 30449 [conf/manager/helper/pool.cpp:241][logid=2210608107 worker_id=140610281404160 optime=1452598610.631276 msg=service+not+found+in+share+memory service=Redis_"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/styles.css"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?bec693dc99391bbe29dd7310e3fff81a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head></html><body><div class="post-header LEFT"><div class="toolbox"><ul class="list-toolbox"><li class="item-toolbox"><a class="CIRCLE" href="/">首页</a></li><li class="item-toolbox"><a class="CIRCLE" href="/categories/">分类</a></li><li class="item-toolbox"><a class="CIRCLE" href="/tags/">标签</a></li><li class="item-toolbox"><a class="CIRCLE" href="/link/">友链</a></li><li class="item-toolbox"><a class="CIRCLE" href="/about/">关于</a></li></ul></div><div class="toolbox tool-vertical" id="tool-vertical"><ul class="list-toolbox list-vertical"><li class="item-toolbox"><a class="CIRCLE VERTICAL" href="/">首页</a></li><li class="item-toolbox"><a class="CIRCLE VERTICAL" href="/categories/">分类</a></li><li class="item-toolbox"><a class="CIRCLE VERTICAL" href="/tags/">标签</a></li><li class="item-toolbox"><a class="CIRCLE VERTICAL" href="/link/">友链</a></li><li class="item-toolbox"><a class="CIRCLE VERTICAL" href="/about/">关于</a></li></ul></div><script type="text/javascript">function getStyle(e){return void 0===e.currentStyle?getComputedStyle(e):e.currentStyle}window.onscroll=function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,t=document.getElementsByClassName("toolbox")[0],l=document.getElementById("tool-vertical"),o=getStyle(l).display,n=document.getElementsByClassName("CIRCLE VERTICAL");if(60<=e&&"none"==o){l.style.display="block",t.style.display="none";for(var s=0;s<n.length;s++)n[s].setAttribute("class","CIRCLE VERTICAL")}if(e<60&&"block"==o)for(t.style.display="block",setTimeout("document.getElementById('tool-vertical').style.display = 'none'",600),s=0;s<n.length;s++)n[s].setAttribute("class",n[s].className+" a-vertical")}</script></div><div id="toc" class="toc-article"><strong class="toc-title">文章目录</strong><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#方法1"><span class="toc-text">方法1.</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#方法2"><span class="toc-text">方法2.</span></a></li></ol></div><div class="content-post LEFT"><article id="post-shell-log" class="article article-type-post" itemscope itemprop="blogPost"><header class="article-header"><h1 class="post-title">Shell从一段日志中取出两个字段的值</h1><div class="article-meta"><span>2016-03-03</span> <span>| </span><span class="article-author">Linxianlong</span> <span>| </span><span class="article-category"><a class="article-category-link" href="/categories/Linux/">Linux</a></span></div></header><div class="article-content"><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">WARNING: <span class="number">01</span><span class="number">-12</span> <span class="number">19</span>:<span class="number">36</span>:<span class="number">50</span>:  ral-worker * <span class="number">30449</span> [conf/manager/helper/pool.cpp:<span class="number">241</span>][logid=<span class="number">2210608107</span> worker_id=<span class="number">140610281404160</span> optime=<span class="number">1452598610.631276</span> msg=service+not+found+in+share+memory service=Redis_doc_push]</span><br></pre></td></tr></table></figure><p>日志如上，我想从这段日志中筛选出service字段和logid字段，<code>Redis_doc_push 2210608107</code></p><h4 id="方法1"><a href="#方法1" class="headerlink" title="方法1."></a>方法1.</h4><p>通过awk获取指定的列后输出，缺点是如果日志打印的格式不规范（如没有用空格分割），则无法使用。</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat xxx.log |  grep -oP <span class="string">"logid=\d+.*service=\w+"</span> | awk -F<span class="string">' '</span> <span class="string">'&#123;print $1,$NF&#125;'</span></span><br></pre></td></tr></table></figure><h4 id="方法2"><a href="#方法2" class="headerlink" title="方法2."></a>方法2.</h4><p>用正则表达式捕获组，用sed将整行替换为两个组的值</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cat xxx.log | sed -r <span class="string">"s/.*?logid=([0-9]+).*?service=(\w+).*?/\1,\2/"</span></span><br></pre></td></tr></table></figure></div></article><section class="disqus-comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></div><script type="text/javascript">!function(){var t=document.getElementsByTagName("article")[0];if(null!=t){imgs=t.getElementsByTagName("img");for(var e=0;e<imgs.length;e++)img=imgs[e],width=parseInt(img.getAttribute("alt").replace("-w","")),0<width&&img.setAttribute("style","width:"+width+"px")}}()</script><script>var disqus_shortname="apeipo",disqus_url="http://longlog.me/2016/03/03/shell-log/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script></body>